(()=>{"use strict";var n=document.getElementById("canvas"),o=n.getContext("webgl"),t=function(n,o,t){var e=a(n,n.VERTEX_SHADER,"\n    attribute vec4 a_Position;\n    void main() {\n        gl_Position = a_Position;\n    }\n"),r=a(n,n.FRAGMENT_SHADER,"\n    precision mediump float;\n    uniform vec3 my_color;\n    void main() {\n        gl_FragColor.rgb = my_color;\n        gl_FragColor.a = 1.0;\n    }\n");if(!e||!r)return null;var i=n.createProgram();if(!i)return console.log("unable to create program"),null;if(n.attachShader(i,e),n.attachShader(i,r),n.linkProgram(i),!n.getProgramParameter(i,n.LINK_STATUS)){var l=n.getProgramInfoLog(i);return console.log("Failed to link program: "+l),n.deleteProgram(i),n.deleteShader(r),n.deleteShader(e),null}return i}(o);t||console.log("Failed to create program"),o.useProgram(t);var e=o.getAttribLocation(t,"a_Position");o.enableVertexAttribArray(e);var r=o.createBuffer();o.bindBuffer(o.ARRAY_BUFFER,r);var i=o.FLOAT;o.vertexAttribPointer(e,2,i,!1,0,0);var l=o.getUniformLocation(t,"my_color");function a(n,o,t){var e=n.createShader(o);if(null===e)return console.log("unable to create shader"),null;if(n.shaderSource(e,t),n.compileShader(e),!n.getShaderParameter(e,n.COMPILE_STATUS)){var r=n.getShaderInfoLog(e);return console.log("Failed to compile shader: "+r),n.deleteShader(e),null}return e}function c(n){console.log(n);var t=[];n.forEach((function(n){t.push(n.x,n.y)}));var e=new Float32Array(t);o.bufferData(o.ARRAY_BUFFER,e,o.STATIC_DRAW);var r=o.LINE_LOOP,i=e.length/2;o.drawArrays(r,0,i)}var u,s=function(){function n(n,o){this.x=0,this.y=0,this.x=n,this.y=o}return n.prototype.copy=function(){return new n(this.x,this.y)},n}(),g=function(){function n(n,o){this.p1=n,this.p2=o}return n.prototype.copy=function(){return new n(this.p1,this.p2)},n}(),f=function(){function n(n){var o=this;this.points=[],n.forEach((function(n){o.points.push(new s(n.x,n.y))}))}return n.prototype.getedges=function(){for(var n=[],o=0;o<this.points.length;o++){var t=this.points[o],e=this.points[(o+1)%this.points.length];n.push(new g(t,e))}return n},n.prototype.copy=function(){return new n(this.points)},n}(),h=function(){function n(){this.loops=[]}return n.prototype.add_loop=function(n){this.loops.push(n.copy())},n}(),p=new h,d=new h,y=document.getElementById("main-polygon-button"),v=document.getElementById("clip-polygon-button"),m=document.getElementById("clip-button"),E=document.getElementById("clear-button"),_=document.getElementById("state-text");!function(n){n[n.MainPolygon=0]="MainPolygon",n[n.ClipPolygon=1]="ClipPolygon"}(u||(u={}));var A=u.MainPolygon,P=[];function R(n,t,e){o.uniform3f(l,n,t,e)}function F(){o.clearColor(1,1,1,1),o.clear(o.COLOR_BUFFER_BIT),R(1,0,0),console.log("main_polygon",p),p.loops.forEach((function(n){c(n.points)})),R(0,0,1),console.log("clip_polygon",d),d.loops.forEach((function(n){c(n.points)})),A===u.MainPolygon?R(1,0,0):R(0,0,1),console.log("current_points",P),P.forEach((function(n){!function(n,t,e){void 0===e&&(e=.01),console.log(n,t);for(var r=[n,t],i=0;i<=100;i++){var l=2*Math.PI/100*i,a=n+e*Math.cos(l),c=t+e*Math.sin(l);r.push(a,c)}var u=new Float32Array(r);o.bufferData(o.ARRAY_BUFFER,u,o.STATIC_DRAW);var s=o.TRIANGLE_FAN,g=u.length/2;o.drawArrays(s,0,g)}(n.x,n.y)}))}y.addEventListener("click",(function(n){P.length>0?alert("请先绘制当前多边形"):(A=u.MainPolygon,_.innerText="输入主多边形")})),v.addEventListener("click",(function(n){P.length>0?alert("请先绘制当前多边形"):(A=u.ClipPolygon,_.innerText="输入裁剪多边形")})),E.addEventListener("click",(function(n){console.log("clear"),p.loops.length=0,d.loops.length=0,P.length=0,F()})),m.addEventListener("click",(function(n){})),n.addEventListener("click",(function(o){var t=function(o,t){var e=n.getBoundingClientRect(),r=n.width,i=n.height;return[(o-e.left)/r*2-1,(t-e.top)/i*-2+1]}(o.clientX,o.clientY),e=t[0],r=t[1];console.log("left click"),P.push(new s(e,r)),F()})),n.addEventListener("contextmenu",(function(n){if(console.log("right click"),n.preventDefault(),P.length<3)alert("至少需要三个点");else{var o=new f(P);console.log(o),A===u.MainPolygon?p.add_loop(o):d.add_loop(o),console.log(p),console.log(d),P.length=0,F()}}))})();